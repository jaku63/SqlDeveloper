--------------------------------------------------------
--  DDL for View VEH_HEAT_CONFIRMATION
--------------------------------------------------------

  CREATE OR REPLACE FORCE VIEW "VEH_HEAT_CONFIRMATION" ("ID", "S_HEAT_ID", "HEAT_ID", "PLANT_UNIT_NO", "SHIFT", "OPERATOR_NAME", "DATE_PRODUCED", "HEARTH_LIFE", "WALL_LIFE", "DELTA_LIFE", "EBT_LIFE", "PREV_HEAT_TAP_TIME", "POWER_ON_TIME", "TAP_TIME", "POWER_ON_TO_TAP", "TAP_TO_TAP", "HOT_METAL_C", "HOT_METAL_SI", "HOT_METAL_MN", "HOT_METAL_P", "HOT_METAL_S", "CELOX_OXY_PPM", "CELOX_C", "CELOX_TEMP", "ENERGY_TOTAL", "KWH_TON_LM", "SHREDED_B1", "BUNDLE_B1", "INT_RET_B1", "SKULL_B1", "PIG_IRON_B1", "DRI_LUMP_B1", "DRI_FINES_B1", "HARD_COKE_B1", "DOLO_LIME_B1", "BURNT_LIME_B1", "TOTAL_B1", "SHREDED_B2", "BUNDLE_B2", "INT_RET_B2", "SKULL_B2", "PIG_IRON_B2", "DRI_LUMP_B2", "DRI_FINES_B2", "HARD_COKE_B2", "DOLO_LIME_B2", "BURNT_LIME_B2", "TOTAL_B2", "B_LIME_FEED", "DOLOMITE_FEED", "DRI_FEED", "RETURN_LM", "HOT_METAL", "TOTAL_CHARGE_WT", "TOTAL_O2_CONS", "MIX_GAS_CONS", "TOTAL_COKE_CONS", "SAMPLER", "TEMP_TIPS", "OTHER", "CPC", "AL_BAR", "KWH_TON_SCRAP", "HOT_HEEL_WEIGHT", "LIQUID_METAL_TAP", "CE_PRACTICE", "NUM_OF_BASKETS", "STEEL_GRADE", "E1_ADDITION", "E1_ADJUST", "E2_ADDITION", "E2_ADJUST", "E3_ADDITION", "E3_ADJUST", "GUNNING_MASS", "FETLING_MASS", "HEARTH_MASS", "EBT_FILLING_MASS", "REFRACTORY_MASS_CONS", "BOTTOM_TEMP1", "BOTTOM_TEMP2", "BOTTOM_TEMP3", "BOTTOM_TEMP4", "BOTTOM_TEMP5", "BOTTOM_TEMP6", "BOTTOM_TEMP7", "BOTTOM_TEMP8", "BOTTOM_TEMP0", "ERRODED1", "ERRODED2", "ERRODED3", "ERRODED4", "ERRODED5", "ERRODED6", "ERRODED7", "ERRODED8", "HM_POURING_THROUGH", "HM_POURING_START", "HM_POURING_STOP", "HM_POURING_REMARK", "EBT_FREE_OPEN", "LADLE_CONDITION", "VER_COMMENT", "FE_MGN_HI_CARBON", "FE_ALLOYS") AS 
  SELECT "ID",
    "S_HEAT_ID" AS S_HEAT_ID,
    (SELECT HEAT_NO FROM S_HEAT WHERE ID="S_HEAT_ID") AS HEAT_ID,
    (SELECT "PLANT_UNIT_NO" FROM C_PLANT_UNIT cpu WHERE cpu.ID=C_PLANT_UNIT_ID) AS "PLANT_UNIT_NO",
    CASE
     WHEN (EXTRACT(HOUR FROM cast(END_TIME as timestamp)) in (1,2,3,4,5,6,7)) then 'A'
     WHEN (EXTRACT(HOUR FROM cast(END_TIME as timestamp)) in (8,9,10,11,12,13,14,15)) then 'B'
     ELSE 'C'
    END  as SHIFT,
    '' as OPERATOR_NAME,
    "END_TIME" as DATE_PRODUCED,
    (SELECT GET_REP_EQ_LIFE('EAF' || "PLANT_UNIT_NO", 'Bottom','HeatCount' )  FROM C_PLANT_UNIT cpu WHERE cpu.ID=C_PLANT_UNIT_ID) as HEARTH_LIFE,
    (SELECT GET_REP_EQ_LIFE('EAF' || "PLANT_UNIT_NO", 'Shell','HeatCount' )  FROM C_PLANT_UNIT cpu WHERE cpu.ID=C_PLANT_UNIT_ID) as WALL_LIFE,
    (SELECT GET_REP_EQ_LIFE('EAF' || "PLANT_UNIT_NO", 'Door','HeatCount' )  FROM C_PLANT_UNIT cpu WHERE cpu.ID=C_PLANT_UNIT_ID) as DELTA_LIFE,
    (SELECT GET_REP_EQ_LIFE('EAF' || "PLANT_UNIT_NO", 'EBT','HeatCount' )  FROM C_PLANT_UNIT cpu WHERE cpu.ID=C_PLANT_UNIT_ID) as EBT_LIFE,
    to_char("START_TIME",'hh24:mi') AS PREV_HEAT_TAP_TIME,
    to_char(("START_TIME" + "T1_TIME"/24/60/60)) as "POWER_ON_TIME",
    to_char("END_TIME",'hh24:mi') as TAP_TIME,
    ("TAP_START" - ("START_TIME" + "T1_TIME"/24/60/60))*24*60 as POWER_ON_TO_TAP, --minutes
    0 as TAP_TO_TAP,
    GET_REP_HM_ANA('C', S_HEAT_ID) as HOT_METAL_C,
    GET_REP_HM_ANA('Si', S_HEAT_ID) as HOT_METAL_SI,
    GET_REP_HM_ANA('Mn', S_HEAT_ID)  as HOT_METAL_MN,
    GET_REP_HM_ANA('P', S_HEAT_ID)  as HOT_METAL_P,
    GET_REP_HM_ANA('S', S_HEAT_ID)  as HOT_METAL_S,
    (SELECT O2_CONTENT FROM P_TEMP_MEAS pt WHERE pt.S_HEAT_ID=pe.S_HEAT_ID AND PLANT_UNIT='EAF' AND CREATED=(SELECT MAX(CREATED) FROM P_TEMP_MEAS pt WHERE pt.S_HEAT_ID=pe.S_HEAT_ID AND PLANT_UNIT='EAF' AND O2_CONTENT>0 ) ) as CELOX_OXY_PPM,
    (SELECT C_CONTENT FROM P_TEMP_MEAS pt WHERE pt.S_HEAT_ID=pe.S_HEAT_ID AND PLANT_UNIT='EAF' AND CREATED=(SELECT MAX(CREATED) FROM P_TEMP_MEAS pt WHERE pt.S_HEAT_ID=pe.S_HEAT_ID AND PLANT_UNIT='EAF' AND C_CONTENT>0 ) ) as CELOX_C,
    (SELECT TEMPERATURE FROM P_TEMP_MEAS pt WHERE pt.S_HEAT_ID=pe.S_HEAT_ID AND PLANT_UNIT='EAF' AND CREATED=(SELECT MAX(CREATED) FROM P_TEMP_MEAS pt WHERE pt.S_HEAT_ID=pe.S_HEAT_ID AND PLANT_UNIT='EAF') )  as CELOX_TEMP,
    "ENERGY_TOTAL",
    0 AS "KWH_TON_LM",
    GET_REP_BASKET_MAT('SHREDED', S_HEAT_ID, 1) as SHREDED_B1,
    GET_REP_BASKET_MAT('BUNDLE', S_HEAT_ID, 1) as BUNDLE_B1,
    GET_REP_BASKET_MAT('INTERNAL', S_HEAT_ID, 1) as INT_RET_B1,
    GET_REP_BASKET_MAT('SKULL', S_HEAT_ID, 1) as SKULL_B1,
    GET_REP_BASKET_MAT('PIG_IRON', S_HEAT_ID, 1) as PIG_IRON_B1,
    GET_REP_BASKET_MAT('DRI_LUMP', S_HEAT_ID, 1) as DRI_LUMP_B1,
    GET_REP_BASKET_MAT('DRI_FINES', S_HEAT_ID, 1) as DRI_FINES_B1,
    GET_REP_BASKET_MAT('HARD_COKE', S_HEAT_ID, 1) as HARD_COKE_B1,
    GET_REP_BASKET_MAT('DOLO_LIME', S_HEAT_ID, 1) as DOLO_LIME_B1,
    GET_REP_BASKET_MAT('BURNT_LIME', S_HEAT_ID, 1) as BURNT_LIME_B1,
    GET_REP_BASKET_MAT('%', S_HEAT_ID, 1) as TOTAL_B1,
    GET_REP_BASKET_MAT('SHREDED', S_HEAT_ID, 2) as SHREDED_B2,
    GET_REP_BASKET_MAT('BUNDLE', S_HEAT_ID, 2) as BUNDLE_B2,
    GET_REP_BASKET_MAT('INTERNAL', S_HEAT_ID, 2) as INT_RET_B2,
    GET_REP_BASKET_MAT('SKULL', S_HEAT_ID, 2) as SKULL_B2,
    GET_REP_BASKET_MAT('PIG_IRON', S_HEAT_ID, 2) as PIG_IRON_B2,
    GET_REP_BASKET_MAT('DRI_LUMP', S_HEAT_ID, 2) as DRI_LUMP_B2,
    GET_REP_BASKET_MAT('DRI_FINES', S_HEAT_ID, 2) as DRI_FINES_B2,
    GET_REP_BASKET_MAT('HARD_COKE', S_HEAT_ID, 2) as HARD_COKE_B2,
    GET_REP_BASKET_MAT('DOLO_LIME', S_HEAT_ID, 2) as DOLO_LIME_B2,
    GET_REP_BASKET_MAT('BURNT_LIME', S_HEAT_ID, 2) as BURNT_LIME_B2,
    GET_REP_BASKET_MAT('%', S_HEAT_ID, 2) as TOTAL_B2,
    LIME_WEIGHT as B_LIME_FEED,
    DOLO_WEIGHT as DOLOMITE_FEED,
    DRI_WEIGHT as DRI_FEED,
    0 as Return_LM,
    (SELECT sum(MAT_WEIGHT) FROM PE_HOT_METAL peh WHERE peh.S_HEAT_ID=pe.S_HEAT_ID) as HOT_METAL,
    (SELECT CHARGE_WEIGHT FROM ME_HEAT peh WHERE peh.S_HEAT_ID=pe.S_HEAT_ID)  as TOTAL_CHARGE_WT,
    OXYGEN_CONS as TOTAL_O2_Cons,
    Mix_Gas_Cons as Mix_Gas_Cons,
    coke_cons as Total_Coke_Cons,
    (select count(1) from P_LAB PANA WHERE PANA.S_HEAT_ID=PE.S_HEAT_ID) as Sampler,
    (select count(1) from P_TEMP_MEAS pm WHERE pm.S_HEAT_ID=PE.S_HEAT_ID)  as Temp_tips,
    0 as Other,
    0 as CPC,
    0 as Al_Bar,
    0 AS "KWH_TON_SCRAP",
    "HOT_HEEL_WEIGHT",
    "STEEL_WEIGHT" as LIQUID_METAL_TAP,
    (SELECT PRACTICE_CODE FROM CE_PRACTICE CEP WHERE CEP.ID="CE_PRACTICE_ID"
    ) AS "CE_PRACTICE",
    "NUM_OF_BASKETS",
    (SELECT STEEL_GRADE FROM C_STEEL_GRADE CS WHERE CS.ID="C_STEEL_GRADE_ID"
    ) AS "STEEL_GRADE",
    0 AS E1_ADDITION,
    0 AS E1_ADJUST,
    0 AS E2_ADDITION,
    0 AS E2_ADJUST,
    0 AS E3_ADDITION,
    0 AS E3_ADJUST,
    0 as GUNNING_MASS,
    0 as FETLING_MASS,
    0 as HEARTH_MASS,
    0 as EBT_FILLING_MASS,
    0 as REFRACTORY_MASS_CONS,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=2 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP1,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=3 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP2,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=4 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP3,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=5 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP4,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=6 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP5,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=7 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP6,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=8 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP7,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=9 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP8,
    (SELECT MEAS_TEMP FROM PE_BOTTOM_TEMP_REPORT pbr WHERE pbr.TEMP_ID=1 AND pbr.S_HEAT_ID=pe.S_HEAT_ID) AS BOTTOM_TEMP0,
    0 as ERRODED1,
    0 as ERRODED2,
    0 as ERRODED3,
    0 as ERRODED4,
    0 as ERRODED5,
    0 as ERRODED6,
    0 as ERRODED7,
    0 as ERRODED8,
    'tilter' as HM_POURING_THROUGH, -- tilter or roof
    '' as HM_POURING_START,
    '' as HM_POURING_STOP,
    '' as HM_POURING_REMARK,
    0 as EBT_FREE_OPEN,
    0 as LADLE_CONDITION,
    VER_COMMENT,
    0 as FE_MGN_HI_CARBON,
    0 as FE_ALLOYS
  FROM PE_HEAT pe;
